<!DOCTYPE html>
<html>
<head>
	<title>Minna Tōhyō</title>
</head>
<script src="/socket.io/socket.io.js"></script>
<script src="clientRuntime.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
<script type="text/javascript">
    // For the sake of time and debugging, the rules will be uncommented near the end of development

    // const rules = ['The questions will appear on-screen and you must come up with your best answers.',
    // 'Once everyone has answered the question, everyone will vote on the best answer.',
    // 'The top 3 answers will get points. The person with the highest points at the end of the game wins!',
    // 'Ready? Here comes the first question.'];

    const rules = ['rules go here'];
    let currentTimerCancel = false;

    async function showRules() {
        for (let i = 0; i < rules.length; i++) {
            await timeoutAsync(() => {
                let elem = document.getElementById('connect-text');
                let newElem = elem.cloneNode(true);
                newElem.innerHTML = rules[i];
                elem.parentNode.replaceChild(newElem, elem);
            }, 7000);
        }

        socket.emit('round-start-ask');

        await timeoutAsync(() => {
            document.getElementById('connect-text').innerHTML = '';
            document.getElementById('connect-text').setAttribute('class', 'question-text');
        }, 7000);
    }
    const socket = io('/host');
    let player = {id: 'not-connected'};
    socket.on('connect', () => {
        socket.emit('auto-assign');
        socket.on('auto-assign-complete', isPlayer => {
            if (isPlayer) {
                const e = document.getElementById('hostButton');
                e.parentNode.removeChild(e);
                document.getElementById('connect-text').innerHTML = 'Connected, however there is already someone hosting...';
            } else document.getElementById('connect-text').innerHTML = `Connected. You are the host.`;
        });

        socket.on('players-update', players => {
            const humanList = [];
            for (let i = 0; i < players.length; i++) humanList.push(`${players[i].nickname} - ${players[i].id}`);
            document.getElementById('user-list').innerHTML = `Connected users:<br>${humanList.join('<br>')}`;
        });

        socket.on('game-start', gameInfo => {
            document.getElementById('connect-text').innerHTML = "Before we start, here's a rundown of the rules.";

            const e = document.getElementById('gameJsonFilePicker');
            const eb = document.getElementById('gameStartButton');

            e.parentNode.removeChild(e);
            eb.parentNode.removeChild(eb);

            document.getElementById('connect-text').setAttribute('class', 'rules-text');

            showRules();
        });

        socket.on('round-start', handleRound);
        socket.on('answer-submit', handleAnswer);
    });
</script>
<script src="joinHandler.js"></script>
<body>
    <div id="user-controls">
            <h1 id="connect-text" class="connect-text">Connecting...</h1>
            <h1 id="countdown-text" style="display: none;">Countdown</h1>
            <p id="submitted-answers" style="display: none;"></p>
            <p id="name-text">Enter your nickname:</p><br>
            <form>
                <input type="text" id="nickname"><br>
                <input type="file" id="gameJsonFilePicker" style="display: none;"><br>
            </form>
            <button id="hostButton" onclick="sendPacketHost(socket)">Host</button> 
            <p id="user-list">No connected players</p>
            <button id="gameStartButton" onclick="sendPacketGameStart(socket)" style="display: none;">Start Game</button> 
    </div>
</body>
</html>